import{a as L}from"./chunk-GFBG3GGK.js";import{Da as P,Db as W,Eb as k,Fb as T,Ga as v,Gb as D,Hb as V,Ib as A,Jb as N,Kb as B,Na as h,Oa as t,Pa as i,Ra as x,Sa as _,Ta as b,V as S,W as y,Ya as O,Za as a,_a as C,ab as g,bb as p,cb as u,oa as s,tb as w,ub as I,vb as F,ya as M}from"./chunk-UIRDYEYR.js";function j(l,c){if(l&1){let m=x();t(0,"div",17),_("click",function(){let d=S(m).$implicit,e=b();return y(e.toggle(d))}),a(1),i()}if(l&2){let m=c.$implicit;O("selected",m.seleccionada),s(),C(m.diente.codigoFDI)}}function G(l,c){if(l&1){let m=x();t(0,"div",17),_("click",function(){let d=S(m).$implicit,e=b();return y(e.toggle(d))}),a(1),i()}if(l&2){let m=c.$implicit;O("selected",m.seleccionada),s(),C(m.diente.codigoFDI)}}function q(l,c){if(l&1&&(t(0,"div",18),a(1),i()),l&2){let m=b();s(),C(m.msg)}}var X=(()=>{let c=class c{constructor(o){this.api=o,this.superiores=[],this.inferiores=[],this.estado="Sano",this.observacion="",this.pacienteId=0,this.fecha="",this.observaciones="",this.loading=!1,this.msg="",this.cargarDientes()}toggle(o){o.seleccionada=!o.seleccionada}aplicarASeleccion(){[...this.superiores,...this.inferiores].forEach(o=>{o.seleccionada&&(o.estado=this.estado,o.observacion=this.observacion)})}guardar(){if(!this.pacienteId||!this.fecha){this.msg="Paciente y fecha son obligatorios.";return}let o=[...this.superiores,...this.inferiores].filter(e=>e.estado);if(!o.length){this.msg="Selecciona al menos un diente con estado.";return}this.loading=!0,this.msg="";let d={fechaRegistro:this.fecha,observacionesGenerales:this.observaciones,paciente:{idPersona:this.pacienteId}};this.api.post("/odontogramas",d).subscribe({next:e=>{let r=e?.idOdontograma;if(!r){this.msg="Odontograma creado sin ID",this.loading=!1;return}let n=o.map(f=>{let z={odontograma:{idOdontograma:r},diente:{idDiente:f.diente.idDiente},estado:f.estado,observacion:f.observacion||""};return this.api.post("/detalles-odontograma",z)}),E=0;n.forEach(f=>f.subscribe({next:()=>{E++,E===n.length&&(this.msg="Odontograma guardado con detalles",this.loading=!1)},error:()=>{this.msg="Error guardando algunos detalles",this.loading=!1}}))},error:()=>{this.msg="Error creando odontograma",this.loading=!1}})}cargarDientes(){this.api.get("/dientes").subscribe({next:o=>{let d=o.slice(0,16),e=o.slice(16,32);this.superiores=d.map(r=>({diente:r,seleccionada:!1})),this.inferiores=e.map(r=>({diente:r,seleccionada:!1}))},error:()=>{this.msg="Error cargando dientes"}})}};c.\u0275fac=function(d){return new(d||c)(M(L))},c.\u0275cmp=P({type:c,selectors:[["app-odontograma-page"]],decls:45,vars:9,consts:[[1,"text-2xl","font-semibold","mb-2"],[1,"text-slate-600","mb-4"],[1,"field"],["type","number",3,"ngModelChange","ngModel"],["type","date",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[1,"row"],[1,"grid"],["class","pieza",3,"selected","click",4,"ngFor","ngForOf"],["value","Sano"],["value","Cariado"],["value","Obturado"],["value","Extracci\xF3n"],["value","Fractura"],[1,"btn",3,"click"],[1,"btn","secondary",2,"margin-left","8px",3,"click","disabled"],["style","margin-top:10px",4,"ngIf"],[1,"pieza",3,"click"],[2,"margin-top","10px"]],template:function(d,e){d&1&&(t(0,"h2",0),a(1,"Odontograma"),i(),t(2,"p",1),a(3,"Selecciona dientes (FDI) y registra condici\xF3n/notas para el paciente."),i(),t(4,"div",2)(5,"label"),a(6,"Paciente ID"),i(),t(7,"input",3),u("ngModelChange",function(n){return p(e.pacienteId,n)||(e.pacienteId=n),n}),i()(),t(8,"div",2)(9,"label"),a(10,"Fecha"),i(),t(11,"input",4),u("ngModelChange",function(n){return p(e.fecha,n)||(e.fecha=n),n}),i()(),t(12,"div",2)(13,"label"),a(14,"Observaciones generales"),i(),t(15,"textarea",5),u("ngModelChange",function(n){return p(e.observaciones,n)||(e.observaciones=n),n}),i()(),t(16,"div",6)(17,"div",7),v(18,j,2,3,"div",8),i()(),t(19,"div",6)(20,"div",7),v(21,G,2,3,"div",8),i()(),t(22,"div",2)(23,"label"),a(24,"Estado"),i(),t(25,"select",5),u("ngModelChange",function(n){return p(e.estado,n)||(e.estado=n),n}),t(26,"option",9),a(27,"Sano"),i(),t(28,"option",10),a(29,"Cariado"),i(),t(30,"option",11),a(31,"Obturado"),i(),t(32,"option",12),a(33,"Extracci\xF3n"),i(),t(34,"option",13),a(35,"Fractura"),i()()(),t(36,"div",2)(37,"label"),a(38,"Observaci\xF3n"),i(),t(39,"textarea",5),u("ngModelChange",function(n){return p(e.observacion,n)||(e.observacion=n),n}),i()(),t(40,"button",14),_("click",function(){return e.aplicarASeleccion()}),a(41,"Aplicar a seleccionados"),i(),t(42,"button",15),_("click",function(){return e.guardar()}),a(43,"Guardar registro"),i(),v(44,q,2,1,"div",16)),d&2&&(s(7),g("ngModel",e.pacienteId),s(4),g("ngModel",e.fecha),s(4),g("ngModel",e.observaciones),s(3),h("ngForOf",e.superiores),s(3),h("ngForOf",e.inferiores),s(4),g("ngModel",e.estado),s(14),g("ngModel",e.observacion),s(3),h("disabled",e.loading),s(2),h("ngIf",e.msg))},dependencies:[F,w,I,B,A,N,W,D,V,k,T],styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(16,36px);gap:8px;justify-content:center}.pieza[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid #cbd5e1}.pieza.selected[_ngcontent-%COMP%]{background:#fde68a;border-color:#f59e0b}.row[_ngcontent-%COMP%]{margin:14px 0}"]});let l=c;return l})();export{X as OdontogramaPageComponent};
