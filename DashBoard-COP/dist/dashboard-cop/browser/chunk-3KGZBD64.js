import{a as P,b as F,c as D,e as W,f as k,g as V,h as L,i as H}from"./chunk-GCM6H2QX.js";import{$a as n,Aa as E,Fa as v,Ja as C,Qa as p,Ra as i,Sa as e,Ua as y,Va as x,Wa as g,X as b,Y as S,ab as u,bb as h,cb as _,db as f,qa as a,wb as w,xb as T,yb as I}from"./chunk-LN2PXZOG.js";function O(s,c){if(s&1&&(i(0,"div",23),n(1),e()),s&2){let o=g();a(),u(o.error)}}function N(s,c){if(s&1&&(i(0,"option",17),n(1),e()),s&2){let o=c.$implicit;p("ngValue",o.idPersona),a(),u(o.nombreCompleto)}}function A(s,c){if(s&1){let o=y();i(0,"tr",29)(1,"td",30),n(2),e(),i(3,"td",30),n(4),e(),i(5,"td",30),n(6),e(),i(7,"td",30),n(8),e(),i(9,"td",30),n(10),e(),i(11,"td",30),n(12),e(),i(13,"td",30)(14,"select",31),f("ngModelChange",function(d){b(o);let t=g(2);return _(t.selectedMedicoId,d)||(t.selectedMedicoId=d),S(d)}),i(15,"option",17),n(16,"Selecciona m\xE9dico"),e(),C(17,N,2,2,"option",18),e(),i(18,"button",7),x("click",function(){let d=b(o).$implicit,t=g(2);return S(t.confirmar(d.idCita))}),n(19,"Confirmar"),e()()()}if(s&2){let o=c.$implicit,r=g(2);a(2),u(o.idCita),a(2),u(o.fecha),a(2),u(o.hora),a(2),u((o.paciente==null?null:o.paciente.nombreCompleto)||(o.paciente==null?null:o.paciente.idP)),a(2),u((o.medico==null?null:o.medico.nombreCompleto)||(o.medico==null?null:o.medico.idMedico)),a(2),u(r.formatServicios(o)),a(2),h("ngModel",r.selectedMedicoId),a(),p("ngValue",null),a(2),p("ngForOf",r.medicos)}}function j(s,c){if(s&1){let o=y();i(0,"table",24)(1,"thead",25)(2,"tr")(3,"th",26),n(4,"ID"),e(),i(5,"th",27),x("click",function(){b(o);let d=g();return S(d.ordenarPor("fecha"))}),n(6,"Fecha"),e(),i(7,"th",27),x("click",function(){b(o);let d=g();return S(d.ordenarPor("hora"))}),n(8,"Hora"),e(),i(9,"th",26),n(10,"Paciente"),e(),i(11,"th",26),n(12,"M\xE9dico"),e(),i(13,"th",26),n(14,"Servicio(s)"),e(),i(15,"th",26),n(16,"Acciones"),e()()(),i(17,"tbody"),C(18,A,20,9,"tr",28),e()()}if(s&2){let o=g();a(18),p("ngForOf",o.citasFiltradas)}}function z(s,c){s&1&&(i(0,"div"),n(1,"No hay citas registradas."),e())}function G(s,c){if(s&1&&(i(0,"option",17),n(1),e()),s&2){let o=c.$implicit;p("ngValue",o.idPersona),a(),u(o.nombreCompleto)}}function Y(s,c){if(s&1&&(i(0,"div",32),n(1),e()),s&2){let o=g();a(),u(o.errorTurno)}}function U(s,c){if(s&1&&(i(0,"div",33),n(1),e()),s&2){let o=g();a(),u(o.okTurno)}}var Z=(()=>{let c=class c{constructor(r){this.api=r,this.citas=[],this.citasFiltradas=[],this.loading=!1,this.error="",this.filtroDesde="",this.filtroHasta="",this.filtroTexto="",this.medicos=[],this.selectedMedicoId=null,this.turnoMedicoId=null,this.horaInicio="",this.horaFin="",this.diasDisponibles="",this.errorTurno="",this.okTurno="",this.load()}load(){this.loading=!0,this.error="",this.api.get("/citas").subscribe({next:r=>{this.citas=r,this.citasFiltradas=[...r],this.loading=!1},error:()=>{this.error="Error cargando citas",this.loading=!1}}),this.api.get("/medicos").subscribe({next:r=>this.medicos=r,error:()=>{}})}formatServicios(r){return(r.servicios||[]).map(d=>d?.tipoServicio||d?.idServicio).filter(d=>!!d).join(", ")}aplicarFiltros(){let r=this.filtroDesde?new Date(this.filtroDesde):null,d=this.filtroHasta?new Date(this.filtroHasta):null,t=(this.filtroTexto||"").toLowerCase();this.citasFiltradas=this.citas.filter(m=>{let l=(()=>{if(!r&&!d)return!0;let M=new Date(m.fecha);return!(r&&M<r||d&&M>d)})(),B=t?(m.paciente?.nombreCompleto||"").toLowerCase().includes(t)||(m.medico?.nombreCompleto||"").toLowerCase().includes(t)||(m.direccion||"").toLowerCase().includes(t):!0;return l&&B})}resetFiltros(){this.filtroDesde=this.filtroHasta=this.filtroTexto="",this.citasFiltradas=[...this.citas]}ordenarPor(r){let d=t=>r==="fecha"?new Date(t).getTime():""+t;this.citasFiltradas.sort((t,m)=>d(t[r])>d(m[r])?1:-1)}confirmar(r){!r||!this.selectedMedicoId||this.api.post(`/citas/${r}/asignar?medicoId=${this.selectedMedicoId}&confirmar=true`,{}).subscribe({next:()=>this.load(),error:()=>this.error="Error confirmando la cita"})}guardarTurno(){if(this.errorTurno="",this.okTurno="",!this.turnoMedicoId){this.errorTurno="Selecciona un m\xE9dico";return}let r={horaInicioDisponibilidad:this.horaInicio?this.horaInicio+":00":null,horaFinDisponibilidad:this.horaFin?this.horaFin+":00":null,diasDisponibles:this.diasDisponibles||null};this.api.put(`/medicos/${this.turnoMedicoId}`,r).subscribe({next:()=>{this.okTurno="Turno actualizado"},error:()=>{this.errorTurno="Error actualizando turno"}})}};c.\u0275fac=function(d){return new(d||c)(E(H))},c.\u0275cmp=v({type:c,selectors:[["app-citas-page"]],decls:53,vars:14,consts:[[1,"text-2xl","font-semibold","mb-2"],[1,"text-slate-600","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"field"],["type","date",3,"ngModelChange","ngModel"],["placeholder","Texto",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-4"],[1,"btn",3,"click"],[1,"btn","secondary",3,"click"],["class","text-red-700 mb-2",4,"ngIf"],[1,"overflow-x-auto","rounded-lg","shadow"],["class","min-w-full bg-white",4,"ngIf"],[4,"ngIf"],[1,"mt-8"],[1,"text-xl","font-semibold","mb-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-4"],[1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","time",1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],["placeholder","D\xEDas disponibles",1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],["class","text-sm text-red-700 mt-2",4,"ngIf"],["class","text-sm text-green-700 mt-2",4,"ngIf"],[1,"text-red-700","mb-2"],[1,"min-w-full","bg-white"],[1,"bg-blue-50"],[1,"px-4","py-2","text-left"],[1,"px-4","py-2","text-left","cursor-pointer",3,"click"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"px-4","py-2"],[1,"border","rounded","px-2","py-1","mr-2",3,"ngModelChange","ngModel"],[1,"text-sm","text-red-700","mt-2"],[1,"text-sm","text-green-700","mt-2"]],template:function(d,t){d&1&&(i(0,"h2",0),n(1,"Gesti\xF3n de Citas"),e(),i(2,"p",1),n(3,"Lista, filtra y organiza las citas agendadas."),e(),i(4,"div",2)(5,"div",3)(6,"label"),n(7,"Desde"),e(),i(8,"input",4),f("ngModelChange",function(l){return _(t.filtroDesde,l)||(t.filtroDesde=l),l}),e()(),i(9,"div",3)(10,"label"),n(11,"Hasta"),e(),i(12,"input",4),f("ngModelChange",function(l){return _(t.filtroHasta,l)||(t.filtroHasta=l),l}),e()(),i(13,"div",3)(14,"label"),n(15,"Buscar por paciente / m\xE9dico"),e(),i(16,"input",5),f("ngModelChange",function(l){return _(t.filtroTexto,l)||(t.filtroTexto=l),l}),e()()(),i(17,"div",6)(18,"button",7),x("click",function(){return t.aplicarFiltros()}),n(19,"Aplicar filtros"),e(),i(20,"button",8),x("click",function(){return t.resetFiltros()}),n(21,"Limpiar"),e()(),C(22,O,2,1,"div",9),i(23,"div",10),C(24,j,19,1,"table",11),e(),C(25,z,2,0,"div",12),i(26,"div",13)(27,"h3",14),n(28,"Gesti\xF3n de Turnos de M\xE9dicos"),e(),i(29,"div",15)(30,"div")(31,"label"),n(32,"M\xE9dico"),e(),i(33,"select",16),f("ngModelChange",function(l){return _(t.turnoMedicoId,l)||(t.turnoMedicoId=l),l}),i(34,"option",17),n(35,"Selecciona m\xE9dico"),e(),C(36,G,2,2,"option",18),e()(),i(37,"div")(38,"label"),n(39,"Hora inicio"),e(),i(40,"input",19),f("ngModelChange",function(l){return _(t.horaInicio,l)||(t.horaInicio=l),l}),e()(),i(41,"div")(42,"label"),n(43,"Hora fin"),e(),i(44,"input",19),f("ngModelChange",function(l){return _(t.horaFin,l)||(t.horaFin=l),l}),e()(),i(45,"div")(46,"label"),n(47,"D\xEDas (ej: MONDAY,TUESDAY)"),e(),i(48,"input",20),f("ngModelChange",function(l){return _(t.diasDisponibles,l)||(t.diasDisponibles=l),l}),e()()(),i(49,"button",7),x("click",function(){return t.guardarTurno()}),n(50,"Guardar turno"),e(),C(51,Y,2,1,"div",21)(52,U,2,1,"div",22),e()),d&2&&(a(8),h("ngModel",t.filtroDesde),a(4),h("ngModel",t.filtroHasta),a(4),h("ngModel",t.filtroTexto),a(6),p("ngIf",t.error),a(2),p("ngIf",t.citasFiltradas.length),a(),p("ngIf",!t.citasFiltradas.length&&!t.loading),a(8),h("ngModel",t.turnoMedicoId),a(),p("ngValue",null),a(2),p("ngForOf",t.medicos),a(4),h("ngModel",t.horaInicio),a(4),h("ngModel",t.horaFin),a(4),h("ngModel",t.diasDisponibles),a(3),p("ngIf",t.errorTurno),a(),p("ngIf",t.okTurno))},dependencies:[I,w,T,L,k,V,P,W,F,D],encapsulation:2});let s=c;return s})();export{Z as CitasPageComponent};
