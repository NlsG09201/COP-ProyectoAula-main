import{a as U}from"./chunk-UG73MJDQ.js";import{$a as u,Ea as T,Gb as H,Ha as v,Hb as W,Ib as Y,Kb as N,Lb as L,Mb as R,Nb as O,Oa as g,Pa as i,Qa as n,Ta as h,Ua as x,Ya as w,_a as s,bb as F,cb as _,db as D,eb as S,pa as l,wb as I,xb as P,yb as A,za as y}from"./chunk-NP5DNCOA.js";function B(d,m){if(d&1&&(i(0,"option",7),s(1),n()),d&2){let c=m.$implicit;g("ngValue",c.idServicio),l(),u(c.nombre||(c.tipoServicio==null?null:c.tipoServicio.nombre))}}function V(d,m){d&1&&(i(0,"div",15),s(1,"Cargando..."),n())}function k(d,m){if(d&1&&(i(0,"div",16),s(1),n()),d&2){let c=x();l(),u(c.error)}}function j(d,m){if(d&1&&(i(0,"tr",21)(1,"td",22),s(2),n(),i(3,"td",22),s(4),n(),i(5,"td",22),s(6),n(),i(7,"td",22),s(8),n(),i(9,"td",22),s(10),n(),i(11,"td",22)(12,"span"),s(13),n()()()),d&2){let c=m.$implicit,e=x(2);l(2),u(c.nombreCompleto),l(2),u(c.email||"\u2014"),l(2),u(c.telefono||"\u2014"),l(2),F("",e.formatHora(c.horaInicioDisponibilidad)," - ",e.formatHora(c.horaFinDisponibilidad)),l(2),u(e.formatDias(c.diasDisponibles)),l(2),w("color",e.estaDisponible(c)?"#16a34a":"#dc2626"),l(),u(e.estaDisponible(c)?"S\xED":"No")}}function J(d,m){if(d&1&&(i(0,"table",17)(1,"thead",18)(2,"tr")(3,"th",19),s(4,"Nombre"),n(),i(5,"th",19),s(6,"Email"),n(),i(7,"th",19),s(8,"Tel\xE9fono"),n(),i(9,"th",19),s(10,"Horario"),n(),i(11,"th",19),s(12,"D\xEDas"),n(),i(13,"th",19),s(14,"Disponible"),n()()(),i(15,"tbody"),v(16,j,14,9,"tr",20),n()()),d&2){let c=x();l(16),g("ngForOf",c.medicosFiltrados)}}var Z=(()=>{let m=class m{constructor(e){this.api=e,this.medicos=[],this.medicosFiltrados=[],this.citas=[],this.filtroFecha="",this.filtroHora="",this.filtroDesde="",this.filtroHasta="",this.filtroTexto="",this.loading=!1,this.error="",this.servicios=[],this.servicioId=null,this.load(),this.cargarServicios()}load(){this.loading=!0,this.error="",this.api.get("/medicos").subscribe({next:e=>{this.medicos=e,this.aplicarFiltros(),this.loading=!1},error:()=>{this.error="Error cargando m\xE9dicos",this.loading=!1}}),this.api.get("/citas").subscribe({next:e=>this.citas=e,error:()=>{}})}cargarServicios(){this.api.get("/servicios").subscribe({next:e=>this.servicios=e,error:()=>{}})}cargarMedicosPorServicio(){this.loading=!0;let e=this.servicioId?`/medicos/por-servicio/${this.servicioId}`:"/medicos";this.api.get(e).subscribe({next:r=>{this.medicos=r,this.aplicarFiltros(),this.loading=!1},error:()=>{this.error="Error cargando m\xE9dicos",this.loading=!1}})}aplicarFiltros(){let e=(this.filtroTexto||"").toLowerCase();this.medicosFiltrados=this.medicos.filter(r=>(!e||(r.nombreCompleto||"").toLowerCase().includes(e)||(r.email||"").toLowerCase().includes(e))&&this.filtroDisponible(r))}resetFiltros(){this.filtroFecha="",this.filtroHora="",this.filtroTexto="",this.filtroDesde="",this.filtroHasta="",this.servicioId=null,this.aplicarFiltros()}filtroDisponible(e){let r=this.filtroHora||"",t=e.horaInicioDisponibilidad||"",a=e.horaFinDisponibilidad||"",o=!r||!t&&!a||(t?r>=t:!0)&&(a?r<=a:!0),p=(e.diasDisponibles||"").toLowerCase();if(this.filtroFecha){let b=new Date(this.filtroFecha),M=!p||p.includes(this.nombreDia(b).toLowerCase())||p.includes(this.diaEnIngles(b)),C=this.existeCita(e,this.filtroFecha,r);return M&&o&&!C}if(this.filtroDesde&&this.filtroHasta){let b=this.diasDelRango(new Date(this.filtroDesde),new Date(this.filtroHasta)),M=!p||b.some(E=>p.includes(E)||p.includes(this.traducirDiaIngles(E))),C=this.existeCitaEnRango(e,this.filtroDesde,this.filtroHasta,r);return M&&o&&!C}let f=this.existeCita(e,this.filtroFecha,r);return o&&!f}existeCita(e,r,t){return!r||!t?!1:this.citas.some(a=>{let o=a.medico?.idPersona===e.idPersona,p=a.fecha===r,f=(a.hora||"").startsWith(t);return!!(o&&p&&f)})}existeCitaEnRango(e,r,t,a){if(!r||!t||!a)return!1;let o=new Date(r).getTime(),p=new Date(t).getTime();return this.citas.some(f=>{let b=f.medico?.idPersona===e.idPersona,M=new Date(f.fecha).getTime(),C=M>=o&&M<=p,E=(f.hora||"").startsWith(a);return!!(b&&C&&E)})}estaDisponible(e){return this.filtroDisponible(e)}formatHora(e){return e?e.substring(0,5):"\u2014"}formatDias(e){if(!e)return"\u2014";let r={MONDAY:"Lunes",TUESDAY:"Martes",WEDNESDAY:"Mi\xE9rcoles",THURSDAY:"Jueves",FRIDAY:"Viernes",SATURDAY:"S\xE1bado",SUNDAY:"Domingo"},t=e;return Object.entries(r).forEach(([a,o])=>{t=t.replaceAll(a,o)}),t}nombreDia(e){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][e.getDay()]}diaEnIngles(e){return["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"][e.getDay()]}traducirDiaIngles(e){return{lunes:"MONDAY",martes:"TUESDAY",mi\u00E9rcoles:"WEDNESDAY",jueves:"THURSDAY",viernes:"FRIDAY",s\u00E1bado:"SATURDAY",domingo:"SUNDAY"}[e.toLowerCase()]||e}diasDelRango(e,r){let t=[];for(let a=new Date(e);a.getTime()<=r.getTime();a.setDate(a.getDate()+1))t.push(this.nombreDia(a).toLowerCase());return t}};m.\u0275fac=function(r){return new(r||m)(y(U))},m.\u0275cmp=T({type:m,selectors:[["app-medicos-page"]],decls:39,vars:11,consts:[[1,"text-2xl","font-semibold","mb-2"],[1,"text-slate-600","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-6","gap-4","mb-4"],[1,"field"],["type","date",3,"ngModelChange","change","ngModel"],["type","time",3,"ngModelChange","change","ngModel"],[3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["placeholder","Buscar por nombre o email",3,"ngModelChange","input","ngModel"],[1,"btn","secondary",3,"click"],["class","card mb-4",4,"ngIf"],["class","card mb-4 text-red-700",4,"ngIf"],[1,"overflow-x-auto","rounded-lg","shadow"],["class","min-w-full bg-white",4,"ngIf"],[1,"card","mb-4"],[1,"card","mb-4","text-red-700"],[1,"min-w-full","bg-white"],[1,"bg-blue-50"],[1,"px-4","py-2","text-left"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"px-4","py-2"]],template:function(r,t){r&1&&(i(0,"h2",0),s(1,"M\xE9dicos disponibles"),n(),i(2,"p",1),s(3,"Filtra por fecha, hora, servicio y texto."),n(),i(4,"div",2)(5,"div",3)(6,"label"),s(7,"Fecha"),n(),i(8,"input",4),S("ngModelChange",function(o){return D(t.filtroFecha,o)||(t.filtroFecha=o),o}),h("change",function(){return t.aplicarFiltros()}),n()(),i(9,"div",3)(10,"label"),s(11,"Hora"),n(),i(12,"input",5),S("ngModelChange",function(o){return D(t.filtroHora,o)||(t.filtroHora=o),o}),h("change",function(){return t.aplicarFiltros()}),n()(),i(13,"div",3)(14,"label"),s(15,"Desde"),n(),i(16,"input",4),S("ngModelChange",function(o){return D(t.filtroDesde,o)||(t.filtroDesde=o),o}),h("change",function(){return t.aplicarFiltros()}),n()(),i(17,"div",3)(18,"label"),s(19,"Hasta"),n(),i(20,"input",4),S("ngModelChange",function(o){return D(t.filtroHasta,o)||(t.filtroHasta=o),o}),h("change",function(){return t.aplicarFiltros()}),n()(),i(21,"div",3)(22,"label"),s(23,"Servicio"),n(),i(24,"select",6),S("ngModelChange",function(o){return D(t.servicioId,o)||(t.servicioId=o),o}),h("change",function(){return t.cargarMedicosPorServicio()}),i(25,"option",7),s(26,"Todos"),n(),v(27,B,2,2,"option",8),n()(),i(28,"div",3)(29,"label"),s(30,"Texto"),n(),i(31,"input",9),S("ngModelChange",function(o){return D(t.filtroTexto,o)||(t.filtroTexto=o),o}),h("input",function(){return t.aplicarFiltros()}),n()(),i(32,"div",3)(33,"button",10),h("click",function(){return t.resetFiltros()}),s(34,"Limpiar filtros"),n()()(),v(35,V,2,0,"div",11)(36,k,2,1,"div",12),i(37,"div",13),v(38,J,17,1,"table",14),n()),r&2&&(l(8),_("ngModel",t.filtroFecha),l(4),_("ngModel",t.filtroHora),l(4),_("ngModel",t.filtroDesde),l(4),_("ngModel",t.filtroHasta),l(4),_("ngModel",t.servicioId),l(),g("ngValue",null),l(2),g("ngForOf",t.servicios),l(4),_("ngModel",t.filtroTexto),l(4),g("ngIf",t.loading),l(),g("ngIf",t.error),l(2),g("ngIf",!t.loading))},dependencies:[A,I,P,O,L,R,H,N,W,Y],encapsulation:2});let d=m;return d})();export{Z as MedicosPageComponent};
