import{c as P}from"./chunk-IVPE62ZD.js";import{a as B}from"./chunk-UG73MJDQ.js";import{$a as u,Ea as v,Gb as F,Ha as C,Hb as D,Ib as W,Kb as k,Lb as V,Mb as L,Nb as H,Oa as p,Pa as i,Qa as t,Sa as E,Ta as x,Ua as g,W as b,X as S,_a as n,cb as h,db as _,eb as f,pa as a,wb as w,xb as T,yb as I,za as y}from"./chunk-NP5DNCOA.js";function N(d,m){if(d&1&&(i(0,"div",23),n(1),t()),d&2){let o=g();a(),u(o.error)}}function A(d,m){if(d&1&&(i(0,"option",17),n(1),t()),d&2){let o=m.$implicit;p("ngValue",o.idPersona),a(),u(o.nombreCompleto)}}function j(d,m){if(d&1){let o=E();i(0,"tr",29)(1,"td",30),n(2),t(),i(3,"td",30),n(4),t(),i(5,"td",30),n(6),t(),i(7,"td",30),n(8),t(),i(9,"td",30),n(10),t(),i(11,"td",30),n(12),t(),i(13,"td",30)(14,"select",31),f("ngModelChange",function(l){b(o);let e=g(2);return _(e.selectedMedicoId,l)||(e.selectedMedicoId=l),S(l)}),i(15,"option",17),n(16,"Selecciona m\xE9dico"),t(),C(17,A,2,2,"option",18),t(),i(18,"button",7),x("click",function(){let l=b(o).$implicit,e=g(2);return S(e.confirmar(l.idCita))}),n(19,"Confirmar"),t()()()}if(d&2){let o=m.$implicit,r=g(2);a(2),u(o.idCita),a(2),u(o.fecha),a(2),u(o.hora),a(2),u((o.paciente==null?null:o.paciente.nombreCompleto)||(o.paciente==null?null:o.paciente.idP)),a(2),u((o.medico==null?null:o.medico.nombreCompleto)||(o.medico==null?null:o.medico.idMedico)),a(2),u(r.formatServicios(o)),a(2),h("ngModel",r.selectedMedicoId),a(),p("ngValue",null),a(2),p("ngForOf",r.medicos)}}function z(d,m){if(d&1){let o=E();i(0,"table",24)(1,"thead",25)(2,"tr")(3,"th",26),n(4,"ID"),t(),i(5,"th",27),x("click",function(){b(o);let l=g();return S(l.ordenarPor("fecha"))}),n(6,"Fecha"),t(),i(7,"th",27),x("click",function(){b(o);let l=g();return S(l.ordenarPor("hora"))}),n(8,"Hora"),t(),i(9,"th",26),n(10,"Paciente"),t(),i(11,"th",26),n(12,"M\xE9dico"),t(),i(13,"th",26),n(14,"Servicio(s)"),t(),i(15,"th",26),n(16,"Acciones"),t()()(),i(17,"tbody"),C(18,j,20,9,"tr",28),t()()}if(d&2){let o=g();a(18),p("ngForOf",o.citasFiltradas)}}function G(d,m){d&1&&(i(0,"div"),n(1,"No hay citas registradas."),t())}function Y(d,m){if(d&1&&(i(0,"option",17),n(1),t()),d&2){let o=m.$implicit;p("ngValue",o.idPersona),a(),u(o.nombreCompleto)}}function R(d,m){if(d&1&&(i(0,"div",32),n(1),t()),d&2){let o=g();a(),u(o.errorTurno)}}function U(d,m){if(d&1&&(i(0,"div",33),n(1),t()),d&2){let o=g();a(),u(o.okTurno)}}var ee=(()=>{let m=class m{constructor(r,l){this.api=r,this.router=l,this.citas=[],this.citasFiltradas=[],this.loading=!1,this.error="",this.filtroDesde="",this.filtroHasta="",this.filtroTexto="",this.medicos=[],this.selectedMedicoId=null,this.turnoMedicoId=null,this.horaInicio="",this.horaFin="",this.diasDisponibles="",this.errorTurno="",this.okTurno="",this.load()}load(){this.loading=!0,this.error="",this.api.get("/citas").subscribe({next:r=>{this.citas=r,this.citasFiltradas=[...r],this.loading=!1},error:()=>{this.error="Error cargando citas",this.loading=!1}}),this.api.get("/medicos").subscribe({next:r=>this.medicos=r,error:()=>{}})}formatServicios(r){return(r.servicios||[]).map(l=>l?.tipoServicio||l?.idServicio).filter(l=>!!l).join(", ")}aplicarFiltros(){let r=this.filtroDesde?new Date(this.filtroDesde):null,l=this.filtroHasta?new Date(this.filtroHasta):null,e=(this.filtroTexto||"").toLowerCase();this.citasFiltradas=this.citas.filter(c=>{let s=(()=>{if(!r&&!l)return!0;let M=new Date(c.fecha);return!(r&&M<r||l&&M>l)})(),O=e?(c.paciente?.nombreCompleto||"").toLowerCase().includes(e)||(c.medico?.nombreCompleto||"").toLowerCase().includes(e)||(c.direccion||"").toLowerCase().includes(e):!0;return s&&O})}resetFiltros(){this.filtroDesde=this.filtroHasta=this.filtroTexto="",this.citasFiltradas=[...this.citas]}ordenarPor(r){let l=e=>r==="fecha"?new Date(e).getTime():""+e;this.citasFiltradas.sort((e,c)=>l(e[r])>l(c[r])?1:-1)}confirmar(r){if(!r||!this.selectedMedicoId)return;let e=this.citas.find(c=>c.idCita===r)?.paciente?.email;if(e)try{sessionStorage.setItem("notifFilterEmail",e)}catch{}this.api.post(`/citas/${r}/asignar?medicoId=${this.selectedMedicoId}&confirmar=true`,{}).subscribe({next:()=>{this.load();try{this.router.navigate(["/notificaciones"])}catch{}},error:()=>this.error="Error confirmando la cita"})}guardarTurno(){if(this.errorTurno="",this.okTurno="",!this.turnoMedicoId){this.errorTurno="Selecciona un m\xE9dico";return}let r={horaInicioDisponibilidad:this.horaInicio?this.horaInicio+":00":null,horaFinDisponibilidad:this.horaFin?this.horaFin+":00":null,diasDisponibles:this.diasDisponibles||null};this.api.put(`/medicos/${this.turnoMedicoId}`,r).subscribe({next:()=>{this.okTurno="Turno actualizado"},error:()=>{this.errorTurno="Error actualizando turno"}})}};m.\u0275fac=function(l){return new(l||m)(y(B),y(P))},m.\u0275cmp=v({type:m,selectors:[["app-citas-page"]],decls:53,vars:14,consts:[[1,"text-2xl","font-semibold","mb-2"],[1,"text-slate-600","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"field"],["type","date",3,"ngModelChange","ngModel"],["placeholder","Texto",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mb-4"],[1,"btn",3,"click"],[1,"btn","secondary",3,"click"],["class","text-red-700 mb-2",4,"ngIf"],[1,"overflow-x-auto","rounded-lg","shadow"],["class","min-w-full bg-white",4,"ngIf"],[4,"ngIf"],[1,"mt-8"],[1,"text-xl","font-semibold","mb-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-4"],[1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","time",1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],["placeholder","D\xEDas disponibles",1,"border","rounded","px-2","py-1",3,"ngModelChange","ngModel"],["class","text-sm text-red-700 mt-2",4,"ngIf"],["class","text-sm text-green-700 mt-2",4,"ngIf"],[1,"text-red-700","mb-2"],[1,"min-w-full","bg-white"],[1,"bg-blue-50"],[1,"px-4","py-2","text-left"],[1,"px-4","py-2","text-left","cursor-pointer",3,"click"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"px-4","py-2"],[1,"border","rounded","px-2","py-1","mr-2",3,"ngModelChange","ngModel"],[1,"text-sm","text-red-700","mt-2"],[1,"text-sm","text-green-700","mt-2"]],template:function(l,e){l&1&&(i(0,"h2",0),n(1,"Gesti\xF3n de Citas"),t(),i(2,"p",1),n(3,"Lista, filtra y organiza las citas agendadas."),t(),i(4,"div",2)(5,"div",3)(6,"label"),n(7,"Desde"),t(),i(8,"input",4),f("ngModelChange",function(s){return _(e.filtroDesde,s)||(e.filtroDesde=s),s}),t()(),i(9,"div",3)(10,"label"),n(11,"Hasta"),t(),i(12,"input",4),f("ngModelChange",function(s){return _(e.filtroHasta,s)||(e.filtroHasta=s),s}),t()(),i(13,"div",3)(14,"label"),n(15,"Buscar por paciente / m\xE9dico"),t(),i(16,"input",5),f("ngModelChange",function(s){return _(e.filtroTexto,s)||(e.filtroTexto=s),s}),t()()(),i(17,"div",6)(18,"button",7),x("click",function(){return e.aplicarFiltros()}),n(19,"Aplicar filtros"),t(),i(20,"button",8),x("click",function(){return e.resetFiltros()}),n(21,"Limpiar"),t()(),C(22,N,2,1,"div",9),i(23,"div",10),C(24,z,19,1,"table",11),t(),C(25,G,2,0,"div",12),i(26,"div",13)(27,"h3",14),n(28,"Gesti\xF3n de Turnos de M\xE9dicos"),t(),i(29,"div",15)(30,"div")(31,"label"),n(32,"M\xE9dico"),t(),i(33,"select",16),f("ngModelChange",function(s){return _(e.turnoMedicoId,s)||(e.turnoMedicoId=s),s}),i(34,"option",17),n(35,"Selecciona m\xE9dico"),t(),C(36,Y,2,2,"option",18),t()(),i(37,"div")(38,"label"),n(39,"Hora inicio"),t(),i(40,"input",19),f("ngModelChange",function(s){return _(e.horaInicio,s)||(e.horaInicio=s),s}),t()(),i(41,"div")(42,"label"),n(43,"Hora fin"),t(),i(44,"input",19),f("ngModelChange",function(s){return _(e.horaFin,s)||(e.horaFin=s),s}),t()(),i(45,"div")(46,"label"),n(47,"D\xEDas (ej: MONDAY,TUESDAY)"),t(),i(48,"input",20),f("ngModelChange",function(s){return _(e.diasDisponibles,s)||(e.diasDisponibles=s),s}),t()()(),i(49,"button",7),x("click",function(){return e.guardarTurno()}),n(50,"Guardar turno"),t(),C(51,R,2,1,"div",21)(52,U,2,1,"div",22),t()),l&2&&(a(8),h("ngModel",e.filtroDesde),a(4),h("ngModel",e.filtroHasta),a(4),h("ngModel",e.filtroTexto),a(6),p("ngIf",e.error),a(2),p("ngIf",e.citasFiltradas.length),a(),p("ngIf",!e.citasFiltradas.length&&!e.loading),a(8),h("ngModel",e.turnoMedicoId),a(),p("ngValue",null),a(2),p("ngForOf",e.medicos),a(4),h("ngModel",e.horaInicio),a(4),h("ngModel",e.horaFin),a(4),h("ngModel",e.diasDisponibles),a(3),p("ngIf",e.errorTurno),a(),p("ngIf",e.okTurno))},dependencies:[I,w,T,H,V,L,F,k,D,W],encapsulation:2});let d=m;return d})();export{ee as CitasPageComponent};
