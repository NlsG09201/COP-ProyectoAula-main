import{a as q}from"./chunk-7YV66IYT.js";import{$a as p,Ea as F,Fb as A,Gb as B,Ha as f,Hb as L,Ib as z,Jb as j,Kb as G,Lb as H,Mb as R,Oa as g,Pa as e,Qa as i,Sa as C,Ta as _,Ua as S,W as y,X as E,Ya as D,Za as O,_a as n,a as I,ab as k,b as M,bb as T,cb as b,db as v,eb as x,p as P,pa as l,vb as W,wb as V,xb as N,za as w}from"./chunk-KRTIOMJ2.js";function K(d,m){if(d&1){let a=C();e(0,"div",20),_("click",function(){let c=y(a).$implicit,t=S();return E(t.toggle(c))}),n(1),i()}if(d&2){let a=m.$implicit;O("selected",a.seleccionada),l(),p(a.diente.codigoFDI)}}function Q(d,m){if(d&1){let a=C();e(0,"div",20),_("click",function(){let c=y(a).$implicit,t=S();return E(t.toggle(c))}),n(1),i()}if(d&2){let a=m.$implicit;O("selected",a.seleccionada),l(),p(a.diente.codigoFDI)}}function U(d,m){if(d&1&&(e(0,"div",21),n(1),i()),d&2){let a=S();l(),p(a.msg)}}function X(d,m){if(d&1&&(e(0,"tr",34)(1,"td",35),n(2),i(),e(3,"td",35),n(4),i(),e(5,"td",35),n(6),i(),e(7,"td",35),n(8),i(),e(9,"td",35)(10,"span"),n(11),i()()()),d&2){let a=m.$implicit;l(2),p(a.diente==null?null:a.diente.codigoFDI),l(2),p(a.diente==null?null:a.diente.nombre),l(2),p(a.estado),l(2),p(a.observacion||"\u2014"),l(2),D("color",a._cambio&&a._cambio.includes("\u2192")?"#16a34a":"#64748b"),l(),p(a._cambio||"\u2014")}}function Y(d,m){if(d&1&&(e(0,"div",25)(1,"div",26),n(2),e(3,"span",27),n(4),i()(),e(5,"div",28),n(6),i(),e(7,"div",29)(8,"table",30)(9,"thead",31)(10,"tr")(11,"th",32),n(12,"FDI"),i(),e(13,"th",32),n(14,"Nombre"),i(),e(15,"th",32),n(16,"Estado"),i(),e(17,"th",32),n(18,"Observaci\xF3n"),i(),e(19,"th",32),n(20,"Cambio"),i()()(),e(21,"tbody"),f(22,X,12,7,"tr",33),i()()()()),d&2){let a=m.$implicit,s=m.index;l(2),T("Registro ",s+1," \u2014 ",a.o.fechaRegistro," "),l(2),k("ID ",a.o.idOdontograma),l(2),p(a.o.observacionesGenerales||"Sin observaciones"),l(16),g("ngForOf",a.detalles)}}function Z(d,m){if(d&1&&(e(0,"div",22)(1,"h3",23),n(2,"Historial odontol\xF3gico"),i(),f(3,Y,23,5,"div",24),i()),d&2){let a=S();l(3),g("ngForOf",a.historial)}}var re=(()=>{let m=class m{constructor(s){this.api=s,this.superiores=[],this.inferiores=[],this.estado="Sano",this.observacion="",this.pacienteId=0,this.fecha="",this.observaciones="",this.loading=!1,this.msg="",this.historial=[],this.cargarDientes()}toggle(s){s.seleccionada=!s.seleccionada}aplicarASeleccion(){[...this.superiores,...this.inferiores].forEach(s=>{s.seleccionada&&(s.estado=this.estado,s.observacion=this.observacion)})}guardar(){if(!this.pacienteId||!this.fecha){this.msg="Paciente y fecha son obligatorios.";return}let s=[...this.superiores,...this.inferiores].filter(t=>t.estado);if(!s.length){this.msg="Selecciona al menos un diente con estado.";return}this.loading=!0,this.msg="";let c={fechaRegistro:this.fecha,observacionesGenerales:this.observaciones,paciente:{idPersona:this.pacienteId}};this.api.post("/odontogramas",c).subscribe({next:t=>{let o=t?.idOdontograma;if(!o){this.msg="Odontograma creado sin ID",this.loading=!1;return}let r=s.map(h=>{let J={odontograma:{idOdontograma:o},diente:{idDiente:h.diente.idDiente},estado:h.estado,observacion:h.observacion||""};return this.api.post("/detalles-odontograma",J)}),u=0;r.forEach(h=>h.subscribe({next:()=>{u++,u===r.length&&(this.msg="Odontograma guardado con detalles",this.loading=!1)},error:()=>{this.msg="Error guardando algunos detalles",this.loading=!1}}))},error:()=>{this.msg="Error creando odontograma",this.loading=!1}})}cargarDientes(){this.api.get("/dientes").subscribe({next:s=>{let c=s.slice(0,16),t=s.slice(16,32);this.superiores=c.map(o=>({diente:o,seleccionada:!1})),this.inferiores=t.map(o=>({diente:o,seleccionada:!1}))},error:()=>{this.msg="Error cargando dientes"}})}cargarHistorial(){if(!this.pacienteId){this.msg="Paciente requerido para historial";return}this.api.get(`/odontogramas/paciente/${this.pacienteId}`).subscribe({next:async s=>{let c=[];for(let t of s||[]){let o=await P(this.api.get(`/detalles-odontograma/odontograma/${t.idOdontograma}`)).catch(()=>[]);c.push({o:t,detalles:this.marcarCambios(o,c.at(-1)?.detalles||[])})}this.historial=c},error:()=>{this.msg="Error cargando historial"}})}marcarCambios(s,c){let t={};return c.forEach(o=>{let r=o.diente?.codigoFDI||""+o.diente?.idDiente;t[r]=o}),(s||[]).map(o=>{let r=o.diente?.codigoFDI||""+o.diente?.idDiente,u=t[r],h=u&&u.estado!==o.estado?`${u.estado} \u2192 ${o.estado}`:u?"Sin cambio":"Nuevo";return M(I({},o),{_cambio:h})})}};m.\u0275fac=function(c){return new(c||m)(w(q))},m.\u0275cmp=F({type:m,selectors:[["app-odontograma-page"]],decls:49,vars:11,consts:[[1,"text-2xl","font-semibold","mb-2"],[1,"text-slate-600","mb-4"],[1,"field"],[2,"display","flex","gap","8px","align-items","center"],["type","number",2,"max-width","200px",3,"ngModelChange","ngModel"],[1,"btn","secondary",3,"click","disabled"],["type","date",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[1,"row"],[1,"grid"],["class","pieza",3,"selected","click",4,"ngFor","ngForOf"],["value","Sano"],["value","Cariado"],["value","Obturado"],["value","Extracci\xF3n"],["value","Fractura"],[1,"btn",3,"click"],[1,"btn","secondary",2,"margin-left","8px",3,"click","disabled"],["style","margin-top:10px",4,"ngIf"],["class","card","style","margin-top:16px",4,"ngIf"],[1,"pieza",3,"click"],[2,"margin-top","10px"],[1,"card",2,"margin-top","16px"],[1,"text-xl","font-semibold","mb-2"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"font-medium"],[1,"text-slate-500"],[1,"text-slate-600","mb-2"],[1,"overflow-x-auto","rounded"],[1,"min-w-full","bg-white"],[1,"bg-blue-50"],[1,"px-3","py-2","text-left"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"px-3","py-2"]],template:function(c,t){c&1&&(e(0,"h2",0),n(1,"Odontograma"),i(),e(2,"p",1),n(3,"Selecciona dientes (FDI) y registra condici\xF3n/notas para el paciente."),i(),e(4,"div",2)(5,"label"),n(6,"Paciente ID"),i(),e(7,"div",3)(8,"input",4),x("ngModelChange",function(r){return v(t.pacienteId,r)||(t.pacienteId=r),r}),i(),e(9,"button",5),_("click",function(){return t.cargarHistorial()}),n(10,"Ver historial"),i()()(),e(11,"div",2)(12,"label"),n(13,"Fecha"),i(),e(14,"input",6),x("ngModelChange",function(r){return v(t.fecha,r)||(t.fecha=r),r}),i()(),e(15,"div",2)(16,"label"),n(17,"Observaciones generales"),i(),e(18,"textarea",7),x("ngModelChange",function(r){return v(t.observaciones,r)||(t.observaciones=r),r}),i()(),e(19,"div",8)(20,"div",9),f(21,K,2,3,"div",10),i()(),e(22,"div",8)(23,"div",9),f(24,Q,2,3,"div",10),i()(),e(25,"div",2)(26,"label"),n(27,"Estado"),i(),e(28,"select",7),x("ngModelChange",function(r){return v(t.estado,r)||(t.estado=r),r}),e(29,"option",11),n(30,"Sano"),i(),e(31,"option",12),n(32,"Cariado"),i(),e(33,"option",13),n(34,"Obturado"),i(),e(35,"option",14),n(36,"Extracci\xF3n"),i(),e(37,"option",15),n(38,"Fractura"),i()()(),e(39,"div",2)(40,"label"),n(41,"Observaci\xF3n"),i(),e(42,"textarea",7),x("ngModelChange",function(r){return v(t.observacion,r)||(t.observacion=r),r}),i()(),e(43,"button",16),_("click",function(){return t.aplicarASeleccion()}),n(44,"Aplicar a seleccionados"),i(),e(45,"button",17),_("click",function(){return t.guardar()}),n(46,"Guardar registro"),i(),f(47,U,2,1,"div",18)(48,Z,4,1,"div",19)),c&2&&(l(8),b("ngModel",t.pacienteId),l(),g("disabled",!t.pacienteId),l(5),b("ngModel",t.fecha),l(4),b("ngModel",t.observaciones),l(3),g("ngForOf",t.superiores),l(3),g("ngForOf",t.inferiores),l(4),b("ngModel",t.estado),l(14),b("ngModel",t.observacion),l(3),g("disabled",t.loading),l(2),g("ngIf",t.msg),l(),g("ngIf",t.historial.length))},dependencies:[N,W,V,R,G,H,A,z,j,B,L],styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(16,36px);gap:8px;justify-content:center}.pieza[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid #cbd5e1}.pieza.selected[_ngcontent-%COMP%]{background:#fde68a;border-color:#f59e0b}.row[_ngcontent-%COMP%]{margin:14px 0}"]});let d=m;return d})();export{re as OdontogramaPageComponent};
